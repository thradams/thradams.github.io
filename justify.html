<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Textarea Justify Selection</title>
  <style>
    body {
      font-family: monospace;
      margin: 20px;
    }
    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
      font-size: 14px;
      white-space: pre; /* preserve spaces & newlines */
    }
    .controls {
      margin: 10px 0;
    }
    .margin-options label {
      margin-right: 10px;
    }
    button {
      margin-left: 8px;
      padding: 4px 8px;
    }
  </style>
</head>
<body>
  <h2>Justify Selected Text (Paragraph Aware)</h2>

  <textarea id="inputText" placeholder="Type your text here..."></textarea>

  <div class="controls">
    Line width (characters):
    <input id="lineWidth" type="number" value="40" min="10">

    <span class="margin-options">
      Margin (spaces):
      <label><input type="radio" name="margin" value="1">1</label>
      <label><input type="radio" name="margin" value="2" checked>2</label>
      <label><input type="radio" name="margin" value="3">3</label>
      <label><input type="radio" name="margin" value="4">4</label>
    </span>

    <button id="justifyBtn">Justify Selection</button>
    <button id="copyBtn">Copy to Clipboard</button>
  </div>

  <script>
    function justifyLine(words, width) {
      if (words.length === 1) return words[0]; // single word line

      const totalChars = words.join('').length;
      const spacesNeeded = width - totalChars;
      const gaps = words.length - 1;

      const base = Math.floor(spacesNeeded / gaps);
      let extra = spacesNeeded % gaps;

      let line = '';
      for (let i = 0; i < words.length; i++) {
        line += words[i];
        if (i < gaps) {
          line += ' '.repeat(base + (extra > 0 ? 1 : 0));
          if (extra > 0) extra--;
        }
      }
      return line;
    }

    function justifyParagraph(text, width, margin) {
      const effectiveWidth = width - margin; // discount margin
      const words = text.trim().split(/\s+/);
      if (words.length === 0) return '';

      const lines = [];
      let current = [];
      let length = 0;

      for (let word of words) {
        if (length + word.length + current.length <= effectiveWidth) {
          current.push(word);
          length += word.length;
        } else {
          lines.push(justifyLine(current, effectiveWidth));
          current = [word];
          length = word.length;
        }
      }
      if (current.length) {
        lines.push(current.join(' ')); // last line left aligned
      }

      return lines.map(line => ' '.repeat(margin) + line).join('\n');
    }

    function justifyText(text, width, margin) {
      // Split by blank lines into paragraphs
      const paragraphs = text
        .replace(/\r\n/g, '\n') // normalize
        .split(/\n\s*\n/);

      return paragraphs
        .map(p => justifyParagraph(p, width, margin))
        .join('\n\n'); // reinsert blank line between paragraphs
    }

    // --- DOM ---
    const textarea = document.getElementById('inputText');
    const lineWidth = document.getElementById('lineWidth');
    const justifyBtn = document.getElementById('justifyBtn');
    const copyBtn = document.getElementById('copyBtn');

    function getSelectedMargin() {
      const checked = document.querySelector('input[name="margin"]:checked');
      return parseInt(checked.value, 10);
    }

    // Justify only the selected text
    justifyBtn.addEventListener('click', () => {
      const width = parseInt(lineWidth.value, 10);
      const margin = getSelectedMargin();

      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;

      if (start === end) {
        alert("Please select some text to justify.");
        return;
      }

      const before = textarea.value.substring(0, start);
      const selected = textarea.value.substring(start, end);
      const after = textarea.value.substring(end);

      const justified = justifyText(selected, width, margin);

      // Replace only the selected portion
      textarea.value = before + justified + after;

      // Keep the new text selected
      textarea.selectionStart = start;
      textarea.selectionEnd = start + justified.length;
    });

    // Copy whole textarea content
    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(textarea.value);
        alert("Text copied to clipboard!");
      } catch (err) {
        alert("Failed to copy text: " + err);
      }
    });
  </script>
</body>
</html>
