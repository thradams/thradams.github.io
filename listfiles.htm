<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
   <title>Thiago's website</title>
   <link href="trastyle.css" type="text/css" rel="stylesheet" />
   <link rel="alternate" type="application/rss+xml" title="RSS" href="http://wwww.thradams/codeblog/rss.xml" />
</head>

<body>
   <div class="pageheader">

      <h2>Thiago R. Adams website</h2>
      <p>
         <a class="linkbox" href="index.htm">HOME</a>
         <a class="linkbox" href="codeblog.htm">CODE-BLOG</a>
         <a class="linkbox" href="about.htm">ABOUT</a>
         <br />
      </p>
   </div>

   <article>
  
      <!-- Page content begin -->

<pre>

<span class="keyword">#include</span> <span class="string">&quot;stdafx.h&quot;</span>


<span class="keyword">#include</span> <span class="string">&quot;stdafx.h&quot;</span>
<span class="keyword">#include</span> &lt;windows.h&gt;
<span class="keyword">#include</span> &lt;Strsafe.h&gt;
<span class="keyword">#include</span> &lt;stdio.h&gt;

<span class="keyword">bool</span> ListFiles(<span class="keyword">const</span> <span class="keyword">wchar_t</span> *sDir,
	<span class="keyword">const</span> <span class="keyword">wchar_t</span>* exta[],
	<span class="keyword">int</span> n,
	<span class="keyword">void</span>(*Callback)(<span class="keyword">const</span> <span class="keyword">wchar_t</span>*,<span class="keyword">void</span>*),
	<span class="keyword">void</span>* data)
{
	WIN32_FIND_DATA fdFile;
	HANDLE hFind = NULL;

	<span class="keyword">wchar_t</span> sPath[MAX_PATH];

	wsprintf(sPath, L<span class="string">&quot;%s\\*.*&quot;</span>, sDir);

	<span class="keyword">if</span> ((hFind = FindFirstFile(sPath, &amp;fdFile)) == INVALID_HANDLE_VALUE)
	{
		<span class="keyword">return</span> <span class="keyword">false</span>;
	}

	<span class="keyword">do</span>
	{
		<span class="comment">//Find first file will always return &quot;.&quot;
</span>		<span class="comment">//    and &quot;..&quot; as the first two directories.
</span>		<span class="keyword">if</span> (wcscmp(fdFile.cFileName, L<span class="string">&quot;.&quot;</span>) != <span class="number">0</span>
			&amp;&amp; wcscmp(fdFile.cFileName, L<span class="string">&quot;..&quot;</span>) != <span class="number">0</span>)
		{
			<span class="comment">//Build up our file path using the passed in
</span>			<span class="comment">//  [sDir] and the file/foldername we just found:
</span>			wsprintf(sPath, L<span class="string">&quot;%s\\%s&quot;</span>, sDir, fdFile.cFileName);

			<span class="keyword">if</span> (fdFile.dwFileAttributes &amp;FILE_ATTRIBUTE_DIRECTORY)
			{
				ListFiles(sPath, exta,n,Callback, data);
			}
			<span class="keyword">else</span>
			{
				
				<span class="keyword">wchar_t</span> drive[_MAX_DRIVE];
				<span class="keyword">wchar_t</span> dir[_MAX_DIR];
				<span class="keyword">wchar_t</span> fname[_MAX_FNAME];
				<span class="keyword">wchar_t</span> ext[_MAX_EXT];

				_wsplitpath(sPath, drive, dir, fname, ext);
				<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++)
				{
					<span class="keyword">if</span> (wcscmp(exta[k], ext) == <span class="number">0</span>)
					{
						Callback(fdFile.cFileName, data);
						<span class="keyword">break</span>;
					}
				}
				
			}
		}
	} <span class="keyword">while</span> (FindNextFile(hFind, &amp;fdFile));

	FindClose(hFind);

	<span class="keyword">return</span> <span class="keyword">true</span>;
}


<span class="keyword">void</span> f(<span class="keyword">const</span> <span class="keyword">wchar_t</span>* fileName, <span class="keyword">void</span>* data)
{
	printf(<span class="string">&quot;%ws\n&quot;</span>, fileName);
}

<span class="keyword">int</span> main()
{
	<span class="keyword">const</span> <span class="keyword">wchar_t</span>* ext[] = { L<span class="string">&quot;.h&quot;</span>, L<span class="string">&quot;.cpp&quot;</span> };
	ListFiles(L<span class="string">&quot;.&quot;</span>,ext, <span class="number">2</span>, &amp;f, <span class="number">0</span>);
    <span class="keyword">return</span> <span class="number">0</span>;
}

</pre>


<!-- Page content end --> 
</article> 
 
</body> 
</html>  