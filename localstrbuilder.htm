<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
   <title>Thiago's website</title>
   <link href="trastyle.css" type="text/css" rel="stylesheet" />
   <link rel="alternate" type="application/rss+xml" title="RSS" href="http://wwww.thradams/codeblog/rss.xml" />
</head>

<body>
   <div class="pageheader">

      <h2>Thiago R. Adams website</h2>
      <p>
         <a class="linkbox" href="index.htm">HOME</a>
         <a class="linkbox" href="codeblog.htm">CODE-BLOG</a>
         <a class="linkbox" href="about.htm">ABOUT</a>
         <br />
      </p>
   </div>

   <article>
  
      <!-- Page content begin -->
<h2> LocalStrBuilder</h2>

<pre>
<span class="keyword">#pragma</span> once

<span class="keyword">#include</span> &lt;stdlib.h&gt;

<span class="keyword">#define</span> LOCALSTRBUILDER_NCHARS <span class="number">7</span>

<span class="keyword">typedef</span> <span class="keyword">struct</span>
{
  <span class="keyword">char</span>* c_str;
  <span class="keyword">int</span> size;
  <span class="keyword">int</span> capacity;
  <span class="keyword">char</span> chars[LOCALSTRBUILDER_NCHARS + <span class="number">1</span>];

} LocalStrBuilder;


<span class="keyword">void</span> LocalStrBuilder_Init(LocalStrBuilder* p);

<span class="keyword">void</span> LocalStrBuilder_Swap(LocalStrBuilder* pA, LocalStrBuilder* pB);

<span class="keyword">void</span> LocalStrBuilder_Destroy(LocalStrBuilder* p);

<span class="keyword">void</span> LocalStrBuilder_Reserve(LocalStrBuilder* p, <span class="keyword">int</span> nelements);

<span class="keyword">void</span> LocalStrBuilder_Print(LocalStrBuilder* p);

<span class="keyword">void</span> LocalStrBuilder_Clear(LocalStrBuilder* p);

<span class="keyword">void</span> LocalStrBuilder_Grow(LocalStrBuilder* p, <span class="keyword">int</span> nelements);

<span class="keyword">void</span> LocalStrBuilder_Append(LocalStrBuilder* p, <span class="keyword">const</span> <span class="keyword">char</span>* source);
<span class="keyword">void</span> LocalStrBuilder_AppendChar(LocalStrBuilder* p, <span class="keyword">char</span> ch);
<span class="keyword">void</span> LocalStrBuilder_Set(LocalStrBuilder* p, <span class="keyword">const</span> <span class="keyword">char</span>* source);



</pre>


<pre>

#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;stdio.h&gt;
#include &quot;LocalStrBuilder.h&quot;


void LocalStrBuilder_Init(LocalStrBuilder* p)
{
  p-&gt;capacity = LOCALSTRBUILDER_NCHARS;
  p-&gt;size = 0;
  p-&gt;c_str = p-&gt;chars;
}

void LocalStrBuilder_Swap(LocalStrBuilder* pA, LocalStrBuilder* pB)
{
  int bA = (pA-&gt;c_str == pA-&gt;chars);
  int bB = (pB-&gt;c_str == pB-&gt;chars);

  LocalStrBuilder temp = *pA;
  *pA = *pB;
  *pB = temp;

  if (bA)
  {
    pB-&gt;c_str = pB-&gt;chars;
  }
  if (bB)
  {
    pA-&gt;c_str = pA-&gt;chars;
  }
}

void LocalStrBuilder_Destroy(LocalStrBuilder* p)
{
  if (p-&gt;c_str != p-&gt;chars)
  {
    free(p-&gt;c_str);
  }
}

void LocalStrBuilder_Reserve(LocalStrBuilder* p, int nelements)
{
  if (nelements &gt; p-&gt;capacity)
  {
    char* pnew = NULL;
    if (nelements &lt;= LOCALSTRBUILDER_NCHARS)
    {
      pnew = p-&gt;chars;
      p-&gt;capacity = LOCALSTRBUILDER_NCHARS;
      p-&gt;c_str = pnew;
    }
    else
    {
      if (p-&gt;capacity &lt;= LOCALSTRBUILDER_NCHARS)
      {
        pnew = (char*)malloc((nelements + 1) * sizeof(char));
        memcpy(pnew, p-&gt;chars, LOCALSTRBUILDER_NCHARS);
      }
      else
      {
        pnew = (char*)realloc(p-&gt;c_str, (nelements + 1) * sizeof(char));
      }

      p-&gt;c_str = pnew;

      if (p-&gt;size == 0)
      {
        pnew[0] = '\0';
      }
      p-&gt;capacity = nelements;
    }
  }
}

void LocalStrBuilder_Print(LocalStrBuilder* p)
{
  printf(&quot;size = %d, capacity = %d, c_str = '%s', internal buffer = %s \n&quot;,
    (int)p-&gt;size,
    (int)p-&gt;capacity,
    p-&gt;c_str,
    (p-&gt;c_str == p-&gt;chars ? &quot;yes&quot; : &quot;no&quot;));
}

void LocalStrBuilder_Clear(LocalStrBuilder* p)
{
  if (p-&gt;c_str)
  {
    p-&gt;c_str[0] = 0;
  }
  p-&gt;size = 0;
}

void LocalStrBuilder_Grow(LocalStrBuilder* p, int nelements)
{
  if (nelements &gt; p-&gt;capacity)
  {
    int new_nelements = p-&gt;capacity + p-&gt;capacity / 2;

    if (new_nelements &lt; nelements)
    {
      new_nelements = nelements;
    }

    LocalStrBuilder_Reserve(p, new_nelements);
  }
}

void LocalStrBuilder_Append(LocalStrBuilder* p, const char* source)
{
  while (*source)
  {
    LocalStrBuilder_AppendChar(p, *source);
    source++;
  }
}


void LocalStrBuilder_Set(LocalStrBuilder* p, const char* source)
{
  LocalStrBuilder_Clear(p);
  while (*source)
  {
    LocalStrBuilder_AppendChar(p, *source);
    source++;
  }
}



void LocalStrBuilder_AppendChar(LocalStrBuilder* p, char ch)
{
  LocalStrBuilder_Grow(p, p-&gt;size + 1);

  p-&gt;c_str[p-&gt;size] = ch;
  p-&gt;c_str[p-&gt;size + 1] = 0;
  p-&gt;size++;
}


</pre>

<!-- Page content end --> 
</article> 
 
</body> 
</html>  